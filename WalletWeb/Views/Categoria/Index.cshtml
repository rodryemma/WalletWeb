@{
    ViewData["Title"] = "Index";
}

<h2 class="mb-4 pb-2 fw-semibold text-secondary">Categoria</h2>

<div class="p-3 bg-white border rounded shadow-sm mb-4">
    <h5 class="mb-3 fw-semibold text-secondary">Filtrar</h5>

    <div class="row g-3">

        <div class="col-sm-12">
            <div class="p-3 bg-light border rounded shadow-sm h-100">
                <div class="text-muted small mb-2">Por movimiento</div>
                <div class="mt-auto">
                    <select id="tipoMovimientoSelect" class="form-select w-auto d-inline-block ms-2">
                        <option value="total">Total</option>
                        <option value="gastos">Gastos</option>
                        <option value="ingresos">Ingresos</option>
                    </select>
                </div>
            </div>
        </div>

    </div>

</div>

<div class="d-flex justify-content-between align-items-center mb-3 mt-5">
    <h4 class="fw-semibold text-secondary">Lista de Categoria</h4>
    <button class="btn-crear btn btn-sm btn-outline-primary" id="btn-crear">
        <i class="bi bi-plus"></i> Agregar
    </button>
</div>

<div>
    <table id="tablaCategoria" class="table table-striped display">
        <thead>
            <tr>
                <th>Fecha Creación</th>
                <th>Categoría</th>
                <th>Tipo</th>
                <th>Descripción</th>
            </tr>
        </thead>
    </table>
</div>

@section Styles {
    <link rel="stylesheet" href="https://cdn.datatables.net/2.3.2/css/dataTables.dataTables.min.css">
}

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/2.3.2/js/dataTables.min.js"></script>
    <script>
        // Región: Cargar DataTable
            $(document).ready(function () {
                    let tabla = $('#tablaCategoria').DataTable({
                    responsive: true,
                    paging: true,
                    destroy: true,
                    language: {
                        url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'
                    },
                    ajax: {
                        url: '/categoria/json',
                        data: function (d) {
                             d.tipoMovimiento = $('#tipoMovimientoSelect').val();
                        }
                    },
                    order: [[0, 'desc']],//Fecha descendente
                    columns: [
                        { data: 'fecha' },
                        { data: 'categoria' },
                        { data: 'tipo' },
                        { data: 'descripcion' },
                        {
                          data: null,
                          orderable: false,
                          searchable: false,
                          render: function (data, type, row) {
                              return `
                                <button class="btn-editar btn btn-sm btn-outline-primary" data-id="${row.id}">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn-eliminar btn btn-sm btn-outline-danger" data-id="${row.id}">
                                    <i class="bi bi-trash"></i>
                                </button>
                              `;
                          }
                        }
                        ]
                });
                //Recargar table por tipomovimiento
                $('#tipoMovimientoSelect').change(function () {
                tabla.ajax.reload();
                });
               
            });

    </script>
}

